---
import siteConfig from '../data/site-config';
import Button from './Button.astro';

type Props = { class?: string };

const { class: className } = Astro.props;
const subscribe = siteConfig.subscribe;
if (!subscribe?.enabled || !subscribe?.form?.action) {
    return;
}
---

<section class:list={['border-main flex flex-col items-center gap-2 border border-dashed px-8 py-12 text-center sm:px-12 sm:py-16', className]}>
    {subscribe.title && <h2 class="w-full max-w-xl font-serif text-2xl leading-tight font-medium sm:text-4xl">{subscribe.title}</h2>}
    {subscribe.text && <p class="w-full max-w-xl text-sm leading-normal">{subscribe.text}</p>}
    <form
        action={subscribe.form.action}
        method="post"
        netlify-honeypot="name"
        data-netlify="true"
        id="subscribe-form"
        name="newsletter"
        class:list={['flex w-full max-w-xl flex-col gap-3.5 sm:flex-row', { 'mt-6': subscribe.title || subscribe.text }]}
    >
        <input name="name" type="text" class="sr-only" placeholder="Name" aria-label="Name" autocomplete="off" />
        <input
            type="email"
            name={subscribe.form.emailFieldName || 'email'}
            required
            autocomplete="email"
            placeholder="Email address"
            class="text-main border-main placeholder:text-main/60 h-9 w-full rounded-full border bg-transparent px-5 py-2 text-sm focus:outline-hidden"
            aria-label="Email address"
        />
        <input name="page" type="hidden" value={Astro.url.pathname} />
        {subscribe.form.hiddenFields?.map((field) => <input type="hidden" name={field.name} value={field.value} />)}
        {
            subscribe.form.honeypotFieldName && (
                <div style="position: absolute; left: -5000px;" aria-hidden="true">
                    <input type="text" name={subscribe.form.honeypotFieldName} tabindex="-1" autocomplete="off" />
                </div>
            )
        }
        <Button type="submit" class="h-9 w-full sm:w-auto">Subscribe</Button>
    </form>
</section>
